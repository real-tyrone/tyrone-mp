REPLACE:goa_decision = {
	is_shown = {
		has_dlc_feature = ip4_content
		c:POR ?= ROOT
		any_primary_culture = {
			cu:portuguese = this
		}
		country_has_state_religion = rel:catholic
		any_scope_state = {
			this = p:x51F0A0.state
		}
		is_subject = no
		NOT = {
			has_variable = goa_decision_initiated
		}
	}

	possible = {
		p:x51F0A0.state = {
			culture_percent_state = {
				target = cu:portuguese
				value > 0.05
			}
			religion_percent_state = {
				target = rel:catholic
				value > 0.85
			}
		}
	}

	when_taken = {
		c:POR ?= {
			trigger_event = {
				id = portuguese_colonialism.15
			}
		}
		set_variable = goa_decision_initiated
	}

	ai_chance = {
		value = 1
	}
}

annex_por_brz = {
	is_shown = {
		c:BRZ ?= this
		any_subject_or_below = {
			country_has_primary_culture = cu:portuguese
		}
		exists = c:POR
		has_law_or_variant = law_type:law_monarchy
		NOT = {
			has_variable = annexing_portugal
		}
	}

	possible = {
		has_technology_researched = pan-nationalism
		any_subject_or_below = {
			country_has_primary_culture = cu:portuguese
			is_subject_type = subject_type_crown_land
			liberty_desire <= 25
		}
		is_at_war = no
		is_diplomatic_play_committed_participant = no
	}

	when_taken = {
		create_diplomatic_play = {
			target_country = c:POR
			type = dp_annex_war
			add_war_goal = { holder = c:POR target_country = c:BRZ type = independence }
		}
		hidden_effect = { #Why? Because annexing subjects is currently bugged for liberty desire
			change_infamy = -50
		}
		set_variable = annexing_portugal
	}

	ai_chance = {
		value = 10
	}
}

annex_brazil_por = {
	is_shown = {
		c:POR ?= this
		any_subject_or_below = {
			country_has_primary_culture = cu:brazilian
		}
		exists = c:BRZ
		has_law_or_variant = law_type:law_monarchy
		NOT = {
			has_variable = annexing_brazil
		}
	}

	possible = {
		OR = {
			has_technology_researched = pan-nationalism
			AND = {
				ruler = {
					has_ideology = ideology:ideology_miguelist
				}
				has_technology_researched = nationalism				
			}
		}
		any_subject_or_below = {
			country_has_primary_culture = cu:brazilian
			is_subject_type = subject_type_crown_land
			liberty_desire <= 25
		}
		is_at_war = no
		is_diplomatic_play_committed_participant = no
	}

	when_taken = {
		create_diplomatic_play = {
			target_country = c:BRZ
			type = dp_annex_war
			add_war_goal = { holder = c:BRZ target_country = c:POR type = independence }
		}
		hidden_effect = { #Why? Because annexing subjects is currently bugged for liberty desire
			change_infamy = -100
		}
		set_variable = annexing_brazil
	}

	ai_chance = {
		value = 10
	}
}

REPLACE:decision_depose_ruling_dynasty = {
	is_shown = {
		OR = {
			has_dlc_feature = voice_of_the_people_content
			has_dlc_feature = ip4_content
		}
		OR = {
			country_has_primary_culture = cu:french
			country_has_primary_culture = cu:spanish
			country_has_primary_culture = cu:portuguese
			country_has_primary_culture = cu:iberian
		}
		has_law = law_type:law_monarchy
		is_revolutionary = no
		is_secessionist = no
	}

	possible = {
		NOR = {
			hidden_trigger = { has_variable = coup_event_active }
			has_journal_entry = je_ip4_coup
			is_involved_in_journal_entry = je_the_first_carlist_war
		}
		any_scope_character = {
			OR = {
				has_role = general
				has_role = admiral
			}
			character_has_ideology_conflicting_with_ruling_dynasty = yes
			NOT = { # You cannot hire a communist to install the Orleanists on the throne
				law_stance = {
					law = law_type:law_monarchy
					value <= disapprove
				}
			}
			custom_tooltip = {
				text = ig_sufficiently_upset_tt
				interest_group = {
					ig_approval < 0
				}
				has_variable = monthly_cached_commander_coup_strength
			}
			trigger_if = {
				limit = {
					has_variable = monthly_cached_commander_coup_strength
				}
				custom_tooltip = {
					text = coup_strength_greater_than_coup_resistance_tt
					var:monthly_cached_commander_coup_strength >= root.country_coup_resistance
				}
			}
		}
	}

	when_taken = {
		ordered_scope_character = {
			limit = {
				OR = {
					has_role = general
					has_role = admiral
				}
				has_variable = monthly_cached_commander_coup_strength
				character_has_ideology_conflicting_with_ruling_dynasty = yes
				NOT = { # You cannot hire a communist to install the Orleanists on the throne
					law_stance = {
						law = law_type:law_monarchy
						value <= disapprove
					}
				}
				var:monthly_cached_commander_coup_strength >= root.country_coup_resistance
				interest_group = {
					ig_approval < 0
				}
			}
			order_by = popularity
			position = 0
			save_scope_as = temp_golpista
		}
		if = {		
			limit = {
				exists = scope:temp_golpista
			}
			custom_tooltip = {
				text = begin_dynastic_coup_tt
			}
			scope:temp_golpista ?= {
				set_variable = commander_doing_coup_on_player_behalf
				add_modifier = {
					name = modifier_dynastic_coup
					days = short_modifier_time
				}
			}
			if = {
				limit = {
					exists = scope:temp_golpista
				}
				create_coup_from_character = {
					CHARACTER = scope:temp_golpista
				}
			}
			if = {
				limit = {
					scope:temp_golpista = {
						has_ideology = ideology:ideology_miguelist
					}
				}
				set_variable = miguelist_coup
			}
		}
		else = {
			custom_tooltip = begin_dynastic_coup_scopeless_tt
		}
	}

	ai_chance = {
		value = 10
	}
}

REPLACE:aus_organise_trialism = {
	is_shown = {
		has_dlc_feature = ip3_content
		c:AUS ?= this
		any_subject_or_below = {
			NOT = {
				country_has_primary_culture = cu:croat
			}
			any_scope_state = {
				state_region = s:STATE_CROATIA
			}
		}
		has_law_or_variant = law_type:law_monarchy
		NOT = {
			has_variable = aus_organised_trialism
		}
	}
	possible = {
		has_technology_researched = nationalism
		has_government_type = gov_dual_monarchy
		any_subject_or_below = {
			NOT = {
				country_has_primary_culture = cu:croat
			}
			any_scope_state = {
				state_region = s:STATE_CROATIA
			}
			OR = {
				relations:root <= 0
				liberty_desire >= 50
				has_attitude = {
					who = ROOT
					attitude = rebellious
				}
			}
		}
		is_at_war = no
		is_diplomatic_play_committed_participant = no
	}
	when_taken = {
		set_variable = aus_organised_trialism
		random_subject_or_below = {
			limit = {
				NOT = {
					country_has_primary_culture = cu:croat
				}
				any_scope_state = {
					state_region = s:STATE_CROATIA
				}
			}
			custom_tooltip = {
				text = austria_trialism.1.t_display_tt
				trigger_event = { id = austria_trialism.1 }
			}
		}
	}
	ai_chance = {
		value = -100
		if = {
			limit = {
				any_subject_or_below = {
					NOT = {
						country_has_primary_culture = cu:croat
					}
					any_scope_state = {
						state_region = s:STATE_CROATIA
					}
					save_temporary_scope_as = hungary_scope
				}
			}
			every_subject_or_below = {
				limit = {
					NOT = {
						country_has_primary_culture = cu:croat
					}
					any_scope_state = {
						state_region = s:STATE_CROATIA
					}
				}
				add = scope:hungary_scope.liberty_desire
			}
			if = {
				limit = {
					scope:hungary_scope = {
						has_attitude = {
							who = ROOT
							attitude = rebellious
						}
					}
				}
				add = 25
			}
			subtract = { # -50 at 100 relations, +50 at -100
				value = "relations(scope:hungary_scope)"
				multiply = 0.5
			}
		}
	}
}

start_great_game_rus = {

	is_shown = {
        has_dlc_feature = ep1_content #Spheres of Influence
		exists = c:RUS
		exists = c:GBR

		NOT = { has_global_variable = great_game_started }
		root = c:RUS
	}

	possible = {
		has_interest_marker_in_region = region_persia
		has_interest_marker_in_region = region_central_asia
		has_interest_marker_in_region = region_caucasus
		has_technology_researched = nationalism
	}
	
	when_taken = {
		if = {
			every_country = {
				limit = {
					OR = {
						c:RUS ?= this
						c:GBR ?= this
						c:PER ?= this
						has_journal_entry = je_unify_afghanistan
					}
					NOT = {
						has_journal_entry = je_great_game_control
					}
				}
				add_journal_entry = { type = je_great_game_control }
			}
		}
		if = {
			c:RUS ? = this
			end_truce = c:PER
		}
        set_global_variable = great_game_started
    }
	
	ai_chance = {
		value = 0
	}

}	

start_great_game_gbr = {

	is_shown = {
        has_dlc_feature = ep1_content #Spheres of Influence
		exists = c:RUS
		exists = c:GBR

		NOT = { has_global_variable = great_game_started }
		root = c:GBR
	}

	possible = {
		has_interest_marker_in_region = region_persia
		has_interest_marker_in_region = region_central_asia
		has_interest_marker_in_region = region_caucasus
		has_technology_researched = nationalism
		game_date >= 1846.1.1
	}
	
	when_taken = {
		if = {
			every_country = {
				limit = {
					OR = {
						c:RUS ?= this
						c:GBR ?= this
						c:PER ?= this
						has_journal_entry = je_unify_afghanistan
					}
					NOT = {
						has_journal_entry = je_great_game_control
					}
				}
				add_journal_entry = { type = je_great_game_control }
			}
		}
        set_global_variable = great_game_started
    }
	
	ai_chance = {
		value = 0
	}

}	

claims_on_algeria = {

	is_shown = {
        has_dlc_feature = voice_of_the_people_content
		exists = c:FRA
		root = c:FRA
		NOT = { has_variable = claims_on_algeria }
        OR = {
            NOT = { owns_entire_state_region = STATE_ORAN }
            NOT = { owns_entire_state_region = STATE_ALGIERS }
            NOT = { owns_entire_state_region = STATE_CONSTANTINE }
        }
	}

	possible = {
		has_interest_marker_in_region = region_north_africa
	}

	when_taken = {
		if = {
			limit = {
				has_dlc_feature = voice_of_the_people_content
			}
		    add_journal_entry = {
			    type = je_conquest_of_algeria
		    }
        }
        if = {
			limit = {
				exists = c:MAS
			}
			create_incident = {
				country = c:MAS
				value = 5
			}
		}
        if = {
			limit = {
				exists = c:AIT
			}
			create_incident = {
				country = c:AIT
				value = 5
			}
		}
        if = {
			limit = {
				exists = c:CON
			}
			create_incident = {
				country = c:CON
				value = 5
			}
		}
		# Add Claims
		s:STATE_ORAN = {
			if = {
				limit = {
					any_scope_state = {
						 NOT = {
							owner = ROOT
						}
					}
				}
				add_claim = ROOT
			}
		}
		s:STATE_ALGIERS = {
			if = {
				limit = {
					any_scope_state = {
						NOT = {
							owner = ROOT
						}
					}
				}
				add_claim = ROOT
			}
		}
		s:STATE_CONSTANTINE = {
			if = {
				limit = {
					any_scope_state = {
						NOT = {
							owner = ROOT
						}
					}
				}
				add_claim = ROOT
			}
		}
        set_variable = claims_on_algeria
    }
	ai_chance = {
		value = 100
	}
}

british_hbc = {

	is_shown = {
		exists = c:HBC
		root = c:GBR
		NOT = { has_variable = annex_hbc }
		any_subject_or_below = {
			OR = {
				country_has_primary_culture = cu:anglo_canadian
				country_has_primary_culture = cu:franco_canadian
			}
		}
		c:ONT = {
			is_subject_of = ROOT
		}
		c:QUE = {
			is_subject_of = ROOT
		}
	}
	
	possible = {
		OR = {
			c:ONT = {
				relations:root >= relations_threshold:cordial
				hidden_trigger = {
					is_subject_of = ROOT
				}
			}
			c:QUE = {
				relations:root >= relations_threshold:cordial
				hidden_trigger = {
					is_subject_of = ROOT
				}
			}
		}
		c:HBC ?= {
			is_at_war = no
			hidden_trigger = {
				is_ai = yes
				is_subject_of = ROOT
			}
			relations:root <= relations_threshold:poor
		}
		is_at_war = no
	}
		
	when_taken = {
		trigger_event = { id = HBC_disband.1 }
	}
}


allow_monopoly_subject = {
	is_shown = {
		NOT = {
			has_law_or_variant = law_laissez_faire_subject 
		}
		is_subject = yes
	}
	
	possible = {
		NOT = {
			has_law_or_variant = law_laissez_faire_subject 
		}
		is_subject = yes
		has_law_or_variant = law_type:law_laissez_faire
	}
	
	when_taken = {
        activate_law = law_type:law_laissez_faire_subject 
	}

	ai_chance = {
		value = 0
	}
}

allow_monopoly_subject_remove = {
	is_shown = {
        has_law = law_type:law_laissez_faire_subject
	}
	
	possible = {
		NOT = {
			has_law_or_variant = law_laissez_faire
		}
		is_subject = yes
		has_law_or_variant = law_type:law_laissez_faire_subject
	}	
	
	when_taken = {        	
        activate_law = law_type:law_laissez_faire	
	}

	ai_chance = {
		value = 10
	}
}